## Sapa Technologies – технический обзор и качество кода

### Общий обзор репозитория

- **Frontend** (`src/`): публичный лендинг на React + Vite + Ant Design, мультиязычность через i18next, форма демо-запроса через `DemoModal` и сервисы в `src/services`.
- **Admin** (`admin/`): отдельная админ-панель на React + Vite + Ant Design для управления вакансиями, статьями, командой и продуктами.
- **API** (`api/`): Node.js + Express, хранение данных в JSON-файлах (`api/data/*.json`) с простыми CRUD-эндпоинтами.
- Документация для запуска и архитектуры уже есть в `ARCHITECTURE.md` и `SETUP.md`; `README.md` содержит бизнес-брииф и контентную постановку от клиента.

---

### Потенциальные точки оптимизации

#### Frontend

- **Навигация и скролл** (`Nav.jsx`):
  - `useEffect` для подписки на `scroll` зависит от `activeSection`, из-за чего обработчик пересоздаётся чаще, чем нужно. Рекомендуется сделать зависимость `[]` и внутри эффекта опираться на `ref`/локальные переменные.
  - Определение активной секции происходит через прямой доступ к DOM (`document.getElementById`, `offsetTop`). На будущее стоит рассмотреть `IntersectionObserver` либо `ref`-ы для секций.
- **Форма демо-запроса** (`DemoModal.jsx`, `mailService.js`, `modalService.js`):
  - Валидация результата отправки письма завязана на конкретную строку ответа (`'Сообщение успешно отправлено'`); лучше договориться о формате `success: true/false` и использовать его.
  - В коде осталось несколько `console.log` (в т.ч. `Mail data`, `Mail response`) — их стоит убрать или обернуть в условие по `NODE_ENV`, чтобы Sonar и линтер не ругались на отладочный вывод.
- **Структура секций** (`Mainlayout.jsx`, компоненты `Brex*`):
  - Повторяется обёртка `section-wrapper` вокруг разных секций; можно вынести конфиг‑массив секций и рендерить их через `map`, чтобы уменьшить дублирование.
  - Тяжёлые секции (статьи, команда, карьера) потенциально можно грузить лениво через `React.lazy` для ускорения первого рендера.
- **Общие моменты**:
  - Вынести магические числа (например, высота навбара `72`, отступы при скролле) в константы.
  - Выделить переиспользуемые карточки (продукты, статьи, вакансии) в базовый компонент, чтобы снизить дублирование разметки.

#### API (`api/server.js`)

- **Синхронный файловый ввод-вывод**:
  - Сейчас используются `fs.readJsonSync` / `fs.writeJsonSync` в обработчиках запросов, что блокирует event loop. Для небольшого трафика это допустимо, но Sonar отметит это как код‑смелл.
  - Рекомендуется постепенно переходить на асинхронные версии или на БД (что уже отмечено в `ARCHITECTURE.md` как требование для production).
- **Валидация входных данных**:
  - В `POST/PUT` эндпоинтах (`vacancies`, `articles`, `team`, `products`) используется `...req.body` без строгой схемы; только для откликов на вакансии уже реализован whitelist полей.
  - Имеет смысл унифицировать подход: ввести схему валидации (например, через `Joi`/`zod`) и везде явно перечислять допустимые поля вместо слепого спреда.
- **Повторяющийся код чтения/записи JSON**:
  - Шаблон чтения/записи JSON‑файлов дублируется в нескольких блоках. Можно вынести вспомогательный модуль (`readJsonSafe`, `writeJsonSafe`), уменьшив дублирование и упростив последующие изменения (например, переход на БД).

#### Admin (`admin/`)

- Структура админки типична для Vite‑приложения (страницы + компоненты).
- Рекомендуется:
  - Вынести общий `axios`‑инстанс с `baseURL` и обработкой ошибок.
  - Централизовать уведомления (`react-toastify`) вместо дублирования `try/catch` в каждом компоненте.
  - На перспективу — добавить хотя бы базовую аутентификацию в админку.

---

### SonarQube: интеграция и ожидаемые замечания

#### Текущее состояние

- В репозитории нет конфигурации SonarQube / SonarCloud (`sonar-project.properties` и связанных скриптов), то есть анализ Sonar пока не подключён.
- ESLint уже настроен и при запуске не показывает ошибок, но Sonar даёт дополнительные метрики (bugs, code smells, дубликаты, сложность).

#### Пример базовой конфигурации SonarQube

Создать файл `sonar-project.properties` в корне проекта с минимальными настройками:

```properties
sonar.projectKey=sapa-tech-landing
sonar.projectName=Sapa Technologies Landing
sonar.sourceEncoding=UTF-8

sonar.sources=src,admin/src,api
sonar.inclusions=**/*.js,**/*.jsx,**/*.ts,**/*.tsx
```

Далее в CI (GitHub Actions/GitLab CI и т.д.) добавить шаг запуска `sonar-scanner` с указанием `sonar.host.url` и токена проекта.

#### Что Sonar, скорее всего, подсветит

- **На фронтенде**:
  - Использование `console.log` в продакшн‑коде (`src/services/mailService.js`, `src/components/DemoModal/DemoModal.jsx`, `DashboardHero`, `CareerSection` и др.).
  - Повышенную сложность некоторых компонентов и повторяющиеся паттерны верстки (карточки, секции).
  - Прямой доступ к DOM без дополнительных проверок (в логике скролла навигации).
- **На бэкенде**:
  - Синхронный файловый ввод‑вывод (`readJsonSync` / `writeJsonSync`) в обработчиках HTTP‑запросов.
  - Отсутствие строгой валидации `req.body` в части эндпоинтов.
  - Повторяющийся код работы с JSON‑файлами.

---

### Краткое резюме

- Архитектура проекта чистая и хорошо документирована, микросервисы (frontend, admin, api) разделены логично.
- Основные улучшения касаются: удаления отладочного вывода, уменьшения дублирования кода, упрощения навигации/скролла и постепенного ухода от синхронного файлового IO в API.
- Подключение SonarQube с базовой конфигурацией позволит формализовать эти рекомендации, отслеживать регрессии и видеть динамику качества кода во времени.

